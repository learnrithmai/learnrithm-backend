datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//////////////////////////
// Shared Helper Models //
//////////////////////////

// (Common types, enums, or helper models can be added here)

//////////////////////////
//  Application Models  //
//////////////////////////

model User {
  id                   String     @id @map("_id") @default(auto()) @db.ObjectId
  email                String     @unique
  password             String     // Ensure hashing before storing
}

model UserInfo {
  id                   String      @id @map("_id") @default(auto()) @db.ObjectId
  userId               String      @unique
  email                String      @unique
  isVerified           Boolean     @default(false)
  Name                 String
  lastLogin            DateTime?
  imgThumbnail         String?
  plan                 planType?  
}

model UserDetails {
  id                          String    @id @map("_id") @default(auto()) @db.ObjectId
  userId                      String    @unique 
  email                       String?   @unique
  plan                        planType?
  ExpirationSubscription      DateTime?
  Name                        String
  birthDate                   DateTime?
  country                     String
  lastLogin                   DateTime?
  institution                 String?
  phoneNumber                 String?   @unique
  linkedin                    String?   @unique
  instagram                   String?
  facebook                    String?
  x                           String?
  imgThumbnail                String?
}

//////////////////////////
//     Course Models    //
//////////////////////////

model Course {
  id                  String   @id @map("_id") @default(auto()) @db.ObjectId
  userId              String? 
  email               String?  
  content             String
  type                String?
  mainTopic           String?
  language            String?
  photo               String?
  createdAt           DateTime @default(now())
  endedAt             DateTime?
}

/////////////////////////////
// Referral Program Models //
/////////////////////////////

model UserReferredBy {
  id                          String   @id @map("_id") @default(auto()) @db.ObjectId
  userId                      String   @unique
  referredUserId              String
  email                       String   @unique
  referredUserEmail           String  
  date                        DateTime
  refCodeUsed                 String
  referringType               ReferringType
  referringSource             String?
}

model referralCode {
  id                          String   @id @map("_id") @default(auto()) @db.ObjectId
  userId                      String
  email                       String
  code                        String  @unique
  referredAmount              Int     @default(0)
}

//////////////////////////
//     Utils Models     //
//////////////////////////

model Token {
  id                   String   @id @map("_id") @default(auto()) @db.ObjectId
  userId               String   @unique
  email                String   @unique
  token                String
  tokenExpires         DateTime @map("tokenExpires") @default(now())
  tokenType            TokenType   
}

model Streaker {
  id                      String   @id @map("_id") @default(auto()) @db.ObjectId
  userId                  String   @unique
  email                   String   @unique
  dateSign                DateTime @default(now())
  courseDo                Boolean  @default(false)
  quizDo                  Boolean  @default(false)
}

model Notifier {
  id                      String   @id @map("_id") @default(auto()) @db.ObjectId
  userId                  String   @unique 
  email                   String   @unique
  notify                  DateTime @default(now())
  notifyType              NotificationType @default(not_set)
}

model Transaction {
  id                String   @id @map("_id") @default(auto()) @db.ObjectId
  email             String   @unique
  duration          String
  subscriptionStart DateTime
  subscriptionEnd   DateTime
  orderId           String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  refunded          Boolean
}

//////////////////////////
//   Quiz Game Models   //
//////////////////////////

model Game {
  id          String     @id @map("_id") @default(auto()) @db.ObjectId
  userId      String     // Reference to User.id
  timeStarted DateTime
  topic       String
  timeEnded   DateTime?
  gameType    GameType
  language    String
  questions   Question[] @relation("GameQuestions")
}

model Question {
  id                String   @id @map("_id") @default(auto()) @db.ObjectId
  question          String
  answer            String
  gameId            String
  options           Json?
  percentageCorrect Float?
  questionType      GameType
  userAnswer        String?
  isCorrect         Boolean?
  game              Game     @relation("GameQuestions", fields: [gameId], references: [id])
}

model TopicCount {
  id    String @id @map("_id") @default(auto()) @db.ObjectId
  topic String @unique
  count Int
}

//////////////////////////
//       Enums          //
//////////////////////////

enum GameType {
  mcq
  open_ended
}

enum TokenType {
  email_validation
  password_reset
}

enum NotificationType {
  email_validation
  password_reset
  streak_course
  streak_quiz
  streak_sign
  streak_hit
  all_user
  update
  new_feature
  not_set
}

enum planType {
  trial_monthly
  trial_yearly
  charged_monthly
  charged_yearly
}

enum ReferringType {
  sign
  trial_monthly
  trial_yearly
  charged_monthly
  charged_yearly
}